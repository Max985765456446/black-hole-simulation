<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Earth - Black Hole Simulation</title>
  <style>
    body { margin: 0; overflow: hidden; }
    canvas { display: block; }
    .controls {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(255, 255, 255, 0.8);
      padding: 10px;
      border-radius: 5px;
      font-family: sans-serif;
    }
    .controls label { display: block; margin-bottom: 5px; }
  </style>
</head>
<body>
  <div class="controls">
    <label>Black Hole Mass (Mâ˜‰): <input type="range" id="mass" min="1" max="20" value="10"></label>
    <label>X Position (sim units): <input type="range" id="xPos" min="-10" max="0" value="-5" step="0.1"></label>
    <label>Y Position (sim units): <input type="range" id="yPos" min="-5" max="5" value="-2.5" step="0.1"></label>
    <label>X Velocity (km/s): <input type="range" id="xVel" min="-20" max="20" value="0"></label>
    <label>Y Velocity (km/s): <input type="range" id="yVel" min="-20" max="20" value="0"></label>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script>
    const AU = 1.496e+8; // km
    const SCALE = 1e6;   // 1 unit = 1 million km
    const G = 6.67430e-20; // km^3/kg/s^2
    const M_sun = 1.989e30; // kg

    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0xeeeeee);

    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.z = 300;

    const renderer = new THREE.WebGLRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    const earthGeometry = new THREE.SphereGeometry(1, 32, 32);
    const earthMaterial = new THREE.MeshBasicMaterial({ color: 0x1E90FF });
    const earth = new THREE.Mesh(earthGeometry, earthMaterial);
    scene.add(earth);

    const blackHoleGeometry = new THREE.SphereGeometry(2, 32, 32);
    const blackHoleMaterial = new THREE.MeshBasicMaterial({ color: 0x000000 });
    const blackHole = new THREE.Mesh(blackHoleGeometry, blackHoleMaterial);
    scene.add(blackHole);

    // Initial black hole state (simulation units)
    let M_bh = 10;
    let r_bh = new THREE.Vector3(-5, -2.5, 0);
    let v_bh = new THREE.Vector3(0, 0, 0);

    // Earth state
    let r_earth = new THREE.Vector3(0, 0, 0);
    let v_earth = new THREE.Vector3(0, 29.78 / SCALE, 0); // scaled km/s

    // Link sliders to simulation
    document.getElementById('mass').addEventListener('input', e => M_bh = parseFloat(e.target.value));
    document.getElementById('xPos').addEventListener('input', e => r_bh.x = parseFloat(e.target.value));
    document.getElementById('yPos').addEventListener('input', e => r_bh.y = parseFloat(e.target.value));
    document.getElementById('xVel').addEventListener('input', e => v_bh.x = parseFloat(e.target.value));
    document.getElementById('yVel').addEventListener('input', e => v_bh.y = parseFloat(e.target.value));

    let lastTime = performance.now();

    function animate(now) {
      requestAnimationFrame(animate);
      const delta = (now - lastTime) / 1000; // seconds
      lastTime = now;

      // Update black hole position
      r_bh.add(v_bh.clone().multiplyScalar(delta / SCALE));
      blackHole.position.copy(r_bh);

      // Compute force from BH on Earth
      const deltaR = new THREE.Vector3().subVectors(r_bh, r_earth);
      const dist = deltaR.length();
      const forceMag = G * M_bh * M_sun / (dist * dist);
      const accel = deltaR.normalize().multiplyScalar(forceMag / 5.972e24); // Earth's mass

      v_earth.add(accel.multiplyScalar(delta));
      r_earth.add(v_earth.clone().multiplyScalar(delta));
      earth.position.copy(r_earth);

      renderer.render(scene, camera);
    }

    animate();
  </script>
</body>
</html>
